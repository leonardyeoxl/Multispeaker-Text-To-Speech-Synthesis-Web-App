FROM pytorch/pytorch

WORKDIR "/workspace"
RUN apt-get clean \
        && apt-get update \
        && apt-get install -y ffmpeg libportaudio2 openssh-server python3-pyqt5 xauth \
        && apt-get -y autoremove \
        && mkdir /var/run/sshd \
        && mkdir /root/.ssh \
        && chmod 700 /root/.ssh \
        && ssh-keygen -A \
        && sed -i "s/^.*PasswordAuthentication.*$/PasswordAuthentication no/" /etc/ssh/sshd_config \
        && sed -i "s/^.*X11Forwarding.*$/X11Forwarding yes/" /etc/ssh/sshd_config \
        && sed -i "s/^.*X11UseLocalhost.*$/X11UseLocalhost no/" /etc/ssh/sshd_config \
        && grep "^X11UseLocalhost" /etc/ssh/sshd_config || echo "X11UseLocalhost no" >> /etc/ssh/sshd_config
ADD requirements.orig.txt /workspace/requirements.txt
RUN pip install -r /workspace/requirements.txt
RUN echo "ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAACAQDkRV6WgLRXP8pJdl9faNKM+Bu1ewFctofSm7UiMnpBWrkYfm4r8QfVUAJYdQMw+Rlqc1OINNWBtBMb3+P9bZd9EIZuZukWoKzG8TMZGfpA2lsxaX6Z37p3FOabYUf/i/h7AUbaPljP08uB5SP44+kZQyrcjR3XlQK4KAGEhybvhCXGRltFyWCaDlw/SVDAAHZtHqgQNclMzjSIr5hZnC9yM7vhvdCH0qIBxAQpp5oRmWXoFqyMtgo8lfvpzW6cbnrqYuBt5nV7L/H5nnlqNY0z0jNslt1l7UC5wknNIseYgQoDRTuvUEc2U31PuZwQiPylQsEqDbqLmDJmS19JCm+LB9mhBvxzcPujHaxz4+7OpF8fXNZWuIMmrhA+hEuToM/efZOvsavRR68q5WdzXb4iaK7I04FC2yYfuUDhumuCpsCLfGOopqYilqdXfGtbgEV48Fsrn+Hz9ywgNDasVMPHcHLbikPnYBLbDiA/U2PkgPXUlIF8ba0FjK5MtxodbpSBwRByVVWfJVugwC8WkvERr4x/xMnEIE37883WyW+tia2kQ0VzpxbWIqeIONPN5tasR8nBWu1Uck8n0aj2mt9PmTD9ZnnwQYsvWtnely8YcXeHSYDhcbPcAxRB/YgMoDKAeZtNBOaPSe3hhOklJslafC+S0foq5lGwHCcVblk/Qw== leonard.yeo@klass.dev" \ 
	>> /root/.ssh/authorized_keys
RUN echo "export PATH=/opt/conda/bin:$PATH" >> /root/.profile
# ENTRYPOINT ["sh", "-c", "/usr/sbin/sshd && bash"]
# CMD ["bash"]